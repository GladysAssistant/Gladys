const logger = require('../../../../utils/logger');

/**
 * @description Store discovered peripheral.
 * @param {Object} peripheralInfo - Peripheral information generated by Broadlink library.
 * @example
 * gladys.broadlink.addPeripheral({
 *  name: 'RM3 Pro Plus',
 *  address: '192.168.1.1',
 *  ...
 * });
 */
function addPeripheral(peripheralInfo) {
  const handler = this.handlers.find((h) => h.matchPeripheral(peripheralInfo));

  if (handler) {
    const { device, peripheral } = handler.buildPeripheral(peripheralInfo);
    const { name, address, mac: macBuffer } = peripheralInfo;
    const mac = macBuffer.toString('hex');

    this.peripherals[mac] = { name, mac, address, ...peripheral };
    this.broadlinkDevices[mac] = device;
  } else {
    logger.info(`Broadlink doesn't manager ${peripheralInfo.module} peripheral`);
  }

  return null;
}

module.exports = {
  addPeripheral,
};
